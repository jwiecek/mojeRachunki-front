<div fxLayout="column">

  <mat-toolbar color="primary">
    <button *ngIf="searchIsClicked" (click)="searchIsClicked = false" mat-button><mat-icon class="back-button">keyboard_arrow_left</mat-icon></button>
    <button *ngIf="!(searchIsClicked || !isMobile)" mat-button [matMenuTriggerFor]="menu"><mat-icon>menu</mat-icon></button>
    <mat-menu #menu="matMenu">
      <button mat-menu-item>Kontakt</button>
      <button mat-menu-item (click)="onLogout()">Wyloguj</button>
    </mat-menu>
    <span *ngIf="!searchIsClicked" (click)="refresh()" class="logo"><a><span>po</span>RACHUNKI</a></span>
    <span *ngIf="!searchIsClicked" class="spacer"></span>
    <span *ngIf="!(searchIsClicked || !isMobile)" (click)="searchIsClicked = true;"><mat-icon class="search" matSuffix>search</mat-icon></span>
    <span [hidden]="!searchIsClicked" class="spacer">
      <form [formGroup]="searchForm">
        <mat-form-field>
          <button mat-button *ngIf="value" matSuffix mat-icon-button aria-label="Clear" (click)="value = ''; clearSearchInput()">
            <mat-icon>close</mat-icon>
          </button>
          <!--<mat-icon class="search" matPrefix>search</mat-icon>-->
          <mat-label></mat-label>
          <input autofocus type="text" #searchRef aria-label="search" matInput formControlName="search" [matAutocomplete]="auto" [(ngModel)]="value" >
          <mat-autocomplete #auto="matAutocomplete" (optionSelected)="getByFilter()">
              <mat-option *ngFor="let option of searchOptions" [value]="option._id">
                {{option._id}} ({{option.idList.length}})
              </mat-option>
          </mat-autocomplete>
        </mat-form-field>
      </form>
    </span>
    <span *ngIf="!isMobile">
       <button mat-button color="primary" mat-flat-button (click)="searchIsClicked = true;">Szukaj</button>
      <button mat-button color="primary" mat-flat-button routerLink="/tags">Moje tagi</button>
      <button mat-button color="primary" mat-flat-button (click)="onLogout()">Wyloguj</button>
    </span>
  </mat-toolbar>

  <div fxLayout="row" *ngIf="userIsAuthenticated" fxFlex>
    <div fxLayout="column" *ngIf="!isMobile" class="filter-left-container">
      <app-filter-dialog></app-filter-dialog>
      <app-change-view-dialog></app-change-view-dialog>
    </div>
    <div fxFlex class="main-view-container" fxLayout="column" fxLayoutAlign="space-between stretch">
      <div fxLayout="column">
        <ng-template #noItem>
          <div class="no-result-box">
            brak rachunków
          </div>
        </ng-template>
        <button *ngIf="!isMobile" mat-stroked-button color="primary" routerLink="/create" class="accent-button">
          <mat-icon>add_circle</mat-icon>
          Dodaj rachunek
        </button>
        <div *ngIf="bills.length; else noItem" class="main-list-block" [@listAnimation]="billsLength" >
          <div #target></div>
          <div>
            <mat-chip-list *ngIf="filter.selectedCategory.length" aria-label="category tags" class="my-chip-list">
              <div class="search-tags-box">
                <span>Kategoria:</span>
                <mat-chip *ngFor="let category of filter.selectedCategory"
                          [removable]="removable" (removed)="removeFilter(category,'category')">
                  {{category}}
                  <mat-icon matChipRemove *ngIf="removable">cancel</mat-icon>
                </mat-chip>
              </div>
            </mat-chip-list>
            <mat-chip-list *ngIf="filter.selectedPrice.length" aria-label="price tags" class="my-chip-list">
              <div class="search-tags-box">
                <span>Cena:</span>
                <mat-chip *ngFor="let price of filter.selectedPrice"
                          [removable]="removable" (removed)="removeFilter(price,'price')">
                  {{price}}
                  <mat-icon matChipRemove *ngIf="removable">cancel</mat-icon>
                </mat-chip>
              </div>
            </mat-chip-list>
            <mat-chip-list *ngIf="filter.selectedWarranty" aria-label="price tags" class="my-chip-list">
              <div class="search-tags-box">
                <span>Pozostało gwarancji:</span>
                <mat-chip [removable]="removable" (removed)="removeFilter(filter.selectedWarranty,'warranty')">
                  {{filter.selectedWarranty}}
                  <mat-icon matChipRemove *ngIf="removable">cancel</mat-icon>
                </mat-chip>
              </div>
            </mat-chip-list>
          </div>
          <mat-card *ngFor="let bill of bills">
            <div fxLayout="row" fxLayoutAlign="space-between center">
              <div fxLayout="column" fxLayoutAlign="center center"  class="date-box">
                <h2>{{bill.purchaseDate | date: 'd'}} {{bill.purchaseDate | date: 'MMM'}}</h2>
                <p>{{bill.purchaseDate | date: 'yyyy'}}</p>
              </div>
              <div fxFlex *ngIf="!bill.expand">
                <h2>{{bill.product}} {{bill.brand}}</h2>
                <p><mat-icon>payment</mat-icon>{{bill.price}}</p>
                <p *ngIf="elementsView.shop"><mat-icon>home</mat-icon>{{bill.shop}}</p>
                <p *ngIf="elementsView.description"><mat-icon>description</mat-icon>{{bill.description}}</p>
                <p *ngIf="elementsView.warrantyEndDate || filter.selectedWarranty"
                   [ngStyle]="{'color':checkIfWarrantyOneMonth(bill) ? '#ff8a80' : 'none'}">
                  <mat-icon>restore</mat-icon>do {{bill.warrantyEndDate | date: 'dd.MM.yyyy'}}</p>
                <p *ngIf="elementsView.purchaseType"><mat-icon>category</mat-icon>{{bill.purchaseType}}</p>
              </div>
              <div *ngIf="bill.expand || !isMobile" fxLayout="row" fxLayoutAlign="end center" class="action-button-box">
                <button type="button" mat-stroked-button color="primary" (click)="showBillPhoto(bill.imageBillPath)">
                  <mat-icon>photo_camera</mat-icon><br><span>zdjęcie</span>
                </button>
                <button type="button" mat-stroked-button color="none" (click)="editBill(bill)">
                  <mat-icon>edit</mat-icon><br><span>edytuj</span>
                </button>
                <button type="button" mat-stroked-button color="warn" (click)="removeBill(bill._id)">
                  <mat-icon>cancel</mat-icon><br><span>usuń</span>
                </button>
              </div>
              <div *ngIf="isMobile" class="action-box" (click)="expandPanel(bill)">
                <div *ngIf="!bill.expand" fxLayout="column" fxLayoutAlign="center center">
                  <mat-icon class="show-file-icon">chevron_right</mat-icon>
                </div>
                <div *ngIf="bill.expand" fxLayout="column" fxLayoutAlign="center center">
                  <mat-icon class="show-file-icon">chevron_left</mat-icon>
                </div>
              </div>
            </div>

          </mat-card>
          <div fxLayout="row" fxLayoutAlign="center none" *ngIf="bills.length > 5">
            <button class="button-box" mat-icon-button (click)="scroll(target)">
              <mat-icon>keyboard_arrow_up</mat-icon><br><p>na górę</p>
            </button>
          </div>
        </div>
      </div>
      <app-toolbar *ngIf="isMobile" [billsWarrantyInMonthLength]="billsWarrantyInMonth" (onViewByWarranty)="getByFilter()"></app-toolbar>

    </div>
  </div>
</div>
